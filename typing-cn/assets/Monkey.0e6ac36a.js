import{r as c,f as i,R as j,j as l,C as B,B as ee,h as C,v as te}from"./vendor.dc513d82.js";import{s as re}from"./index.c9cbbc2e.js";import{w}from"./wordTool.4b983422.js";import{R as G,T as ne}from"./ReloadBtn.fbaa85e0.js";const R=32,se=8,x=d=>Array.from(d.children),{Countdown:oe}=te,le=d=>{const $=c.exports.useRef(null),f=c.exports.useRef(null),U=c.exports.useRef(null),F=c.exports.useRef(w.getWords(d.$state.root.wordsMode,d.$state.root.customerWords)),g=c.exports.useRef([0,0]),a=c.exports.useRef({wpm:"",right:0,wrong:0,acc:0,time:{begin:0,secs:0}}),[v,k]=c.exports.useState(!1),[q,H]=c.exports.useState(Date.now()+1e3*60*5+1e3),[J,y]=c.exports.useState(!1),[I,T]=c.exports.useState(!1),[Q,D]=c.exports.useState(!1),[N,M]=c.exports.useState(!1),[p,S]=c.exports.useState(""),[h,A]=c.exports.useState([]),[L,P]=c.exports.useState({top:0,left:0}),[b,X]=c.exports.useState(30),Y=()=>{k(!v),H(Date.now()+1e3*60*5)},W=()=>{const r=g.current,e=f.current.getBoundingClientRect(),t=x(f.current)[r[0]];if(!t)return;const n=Array.from(t.getElementsByClassName("letter"));if(n.length<=r[1]){const s=n[r[1]-1].getBoundingClientRect();P({top:s.top-e.top+2,left:s.left-e.left+s.width})}else{const s=n[r[1]].getBoundingClientRect();P({top:s.top-e.top+2,left:s.left-e.left})}},Z=c.exports.useCallback((r,e)=>{const t=g.current,n=p===""||p.charAt(p.length-1)===" ";let s;if(r===R)n?s=t:s=[t[0]+1,0];else{if(t[1]>=h[t[0]].letterArr.length){const o=x(f.current)[t[0]],u=document.createElement("code");u.className="letter wrong extra-letter",u.innerText=e,o.appendChild(u)}s=[t[0],t[1]+1]}g.current=s,W(),A(o=>{const u=o[t[0]].letterArr[t[1]];if(u&&r!==R&&(u.isCorrect=e===u.letter,u.inputVal=e,console.log(e),o[t[0]].letterArr[t[1]]=u),r===R&&!n)if(o[t[0]].letterArr.some(m=>m.isCorrect===null))o[t[0]].isSkip=!0,o[t[0]].isCorrect=!1;else{const K=x(f.current)[t[0]].getElementsByClassName("extra-letter");!K||K.length===0?o[t[0]].isCorrect=o[t[0]].letterArr.every(_=>_.isCorrect):o[t[0]].isCorrect=!1}return(s[0]>o.length-1||t[0]===o.length-1&&t[1]===o[t[0]].letterArr.length-1)&&(o[t[0]].isCorrect=o[t[0]].letterArr.every(m=>m.isCorrect),a.current.right=o.filter(m=>m.isCorrect).length,a.current.wrong=o.length-a.current.right,a.current.acc=Math.round(a.current.right/(a.current.right+a.current.wrong)*100),a.current.time.secs=Math.round((Date.now()-a.current.time.begin)/1e3),a.current.wpm=(a.current.right/(a.current.time.secs/60)).toFixed(2),y(!1),D(!0),setTimeout(()=>{M(!0)},150)),o}),S(o=>r===R&&(o===""||o.charAt(o.length-1)===" ")?o:o+e)},[p,h]),O=c.exports.useCallback(()=>{const r=p.charAt(p.length-1);if(r==="")return;const e=g.current;let t;if(r===" ")if(h[e[0]-1].isCorrect)t=e;else if(h[e[0]-1].isSkip){const n=h[e[0]-1].letterArr.findIndex(s=>s.isCorrect===null);t=[e[0]-1,n]}else{const s=x(f.current)[e[0]-1].getElementsByClassName("letter");t=[e[0]-1,s.length]}else{const n=x(f.current)[e[0]],s=n.getElementsByClassName("extra-letter");s&&s.length>0&&n.removeChild(s[s.length-1]),t=[e[0],e[1]-1]}g.current=t,W(),A(n=>(r===" "?n[e[0]-1].isCorrect===!1&&(n[e[0]-1].isCorrect=null):n[e[0]].letterArr.length>=e[1]&&(n[e[0]].letterArr[e[1]-1].isCorrect=null,n[e[0]].isCorrect=null),n)),S(n=>{let s=!0;return r===" "&&h[e[0]-1].isCorrect&&(s=!1),s?n.substring(0,n.length-1):n})},[p,h]),V=r=>{r.keyCode!==9&&(r.preventDefault(),r.stopPropagation(),r.persist()),!N&&(T(!1),r.key.length===1?(a.current.time.begin===0&&(a.current.time.begin=Date.now()),Z(r.keyCode,r.key)):r.keyCode===se&&O())},z=()=>{y(!0),$.current.focus()},E=c.exports.useCallback(()=>{g.current=[0,0],F.current=w.shuffle(F.current),a.current={wpm:"",right:0,wrong:0,acc:0,time:{begin:0,secs:0}};const r=f.current.getElementsByClassName("extra-letter");r.length!==0&&Array.from(r).forEach(e=>{e.parentNode.removeChild(e)}),S(""),D(!1),M(!1),setTimeout(()=>{z(),W()},10)},[b]);return c.exports.useEffect(()=>{F.current=w.getWords(d.$state.root.wordsMode,d.$state.root.customerWords),E()},[d.$state.root.wordsMode,d.$state.root.customerWords,E,b]),i("div",{className:"Monkey",children:[i(j,{style:{position:"fixed",top:0,right:0,padding:"20px",zIndex:1},children:[l(B,{children:v?l(oe,{value:q,format:"m:ss",valueStyle:{color:"yellow",fontWeight:"bold",padding:"10px",margin:"5px"},onFinish:()=>k(!1)}):l("div",{style:{fontSize:"24px",color:"yellow",fontWeight:"bold",padding:"10px",margin:"5px"},children:"5:00"})}),i(B,{children:[" ",l(ee,{"vertical-align":"middle",type:"primary",shape:"round",onClick:Y,style:{marginTop:"15px"},children:"\u5F00\u59CB\u5012\u8BA1\u65F6"})]})]}),l("div",{className:"word-count-radio",children:i(C.Group,{value:b,size:"small",onChange:r=>{X(r.target.value)},children:[l(C.Button,{tabIndex:-1,value:20,children:"20"}),l(C.Button,{tabIndex:-1,value:30,children:"30"}),l(C.Button,{tabIndex:-1,value:40,children:"40"}),l(C.Button,{tabIndex:-1,value:50,children:"50"}),l(C.Button,{tabIndex:-1,value:100,children:"100"})]})}),i(j,{justify:"center",align:"middle",children:[i(B,{flex:"900px",className:`type-main-box ${Q?"fading":""} ${N?"hide":""}`,children:[l("div",{className:`caret ${J?I?"flash":"":"hide"}`,ref:U,style:{transform:`translate3d(${L.left}px,${L.top}px,0)`}}),l("div",{className:"words-box",onClick:z,ref:f,children:h.map((r,e)=>{var t;return i("div",{className:`word ${r.isCorrect?"correct":r.isCorrect===!1?"wrong":""}`,children:[l("div",{className:"label",children:r.label}),(t=r.letterArr)==null?void 0:t.map((n,s)=>l("code",{className:`letter ${n.isCorrect?"correct":n.isCorrect===!1?"wrong":""}`,children:n.isCorrect===!1?n.inputVal:n.letter},`${e}_${s}`))]},e)})}),l("input",{className:"hidden-input",type:"text",ref:$,onKeyDown:V,onBlur:()=>{y(!1)},onFocus:()=>{y(!0),T(!0)}}),l("div",{className:"reload-line",children:l(G,{onClick:E})}),i("div",{className:`tip-line ${I?"":"hide"}`,children:[l("div",{children:"\u70B9\u51FB\u8BCD\u5757\u8FDB\u5165\u8F93\u5165\u72B6\u6001"}),l("div",{children:"\u8F93\u5165\u6B63\u786E\u7684\u5B57\u7B26\uFF0C\u7136\u540E\u7A7A\u683C"}),i("div",{children:["\u8F93\u5165\u72B6\u6001\u4E0B",l("code",{children:"Tab"}),"\u540E\u56DE\u8F66\u53EF\u4EE5\u76F4\u63A5\u5237\u65B0"]})]})]}),i(B,{flex:"900px",className:`type-result-box ${N?"show":""}`,children:[l(ne,{desc:"WPM",numStr:a.current.wpm,acc:a.current.acc,secs:a.current.time.secs}),l("div",{className:"reload-line",children:l(G,{onClick:E})})]})]})]})};var de=re(le);export{de as default};
