import{r as l,f as d,R as j,j as c,C as k,B as te,h as z,v as re}from"./vendor.dc513d82.js";import{s as ne}from"./index.315ad7f4.js";import{w as F}from"./wordTool.e11cef7d.js";import{R as G,T as se}from"./ReloadBtn.fbaa85e0.js";const x=32,oe=8,y=f=>Array.from(f.children),{Countdown:le}=re,ce=f=>{const m=l.exports.useRef(null),a=l.exports.useRef(null),U=l.exports.useRef(null),E=l.exports.useRef(F.getWords(f.$state.root.wordsMode,f.$state.root.customerWords)),g=l.exports.useRef([0,0]),i=l.exports.useRef({wpm:"",right:0,wrong:0,acc:0,time:{begin:0,secs:0}}),Y=()=>{const e=window.scrollY,t=window.innerHeight,r=document.documentElement.scrollHeight;e+t>=r&&a.current.scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"})},[$,T]=l.exports.useState(!1),[q,J]=l.exports.useState(Date.now()+1e3*60*5+1e3),[O,B]=l.exports.useState(!1),[D,I]=l.exports.useState(!1),[Q,A]=l.exports.useState(!1),[N,v]=l.exports.useState(!1),[p,S]=l.exports.useState(""),[h,W]=l.exports.useState([]),[M,L]=l.exports.useState({top:0,left:0}),[w,V]=l.exports.useState(100),X=()=>{T(!$),J(Date.now()+1e3*60*5)},b=()=>{const e=g.current,t=a.current.getBoundingClientRect(),r=y(a.current)[e[0]];if(!r)return;const n=Array.from(r.getElementsByClassName("letter"));if(n.length<=e[1]){const s=n[e[1]-1].getBoundingClientRect();L({top:s.top-t.top+2,left:s.left-t.left+s.width})}else{const s=n[e[1]].getBoundingClientRect();L({top:s.top-t.top+2,left:s.left-t.left})}},P=l.exports.useCallback((e,t)=>{const r=g.current,n=p===""||p.charAt(p.length-1)===" ";let s;if(e===x)n?s=r:s=[r[0]+1,0];else{if(r[1]>=h[r[0]].letterArr.length){const o=y(a.current)[r[0]],u=document.createElement("code");u.className="letter wrong extra-letter",u.innerText=t,o.appendChild(u)}s=[r[0],r[1]+1]}g.current=s,b(),W(o=>{const u=o[r[0]].letterArr[r[1]];if(u&&e!==x&&(u.isCorrect=t===u.letter,u.inputVal=t,console.log(t),o[r[0]].letterArr[r[1]]=u),e===x&&!n)if(o[r[0]].letterArr.some(C=>C.isCorrect===null))o[r[0]].isSkip=!0,o[r[0]].isCorrect=!1;else{const K=y(a.current)[r[0]].getElementsByClassName("extra-letter");!K||K.length===0?o[r[0]].isCorrect=o[r[0]].letterArr.every(ee=>ee.isCorrect):o[r[0]].isCorrect=!1}return(s[0]>o.length-1||r[0]===o.length-1&&r[1]===o[r[0]].letterArr.length-1)&&(o[r[0]].isCorrect=o[r[0]].letterArr.every(C=>C.isCorrect),i.current.right=o.filter(C=>C.isCorrect).length,i.current.wrong=o.length-i.current.right,i.current.acc=Math.round(i.current.right/(i.current.right+i.current.wrong)*100),i.current.time.secs=Math.round((Date.now()-i.current.time.begin)/1e3),i.current.wpm=(i.current.right/(i.current.time.secs/60)).toFixed(2),B(!1),A(!0),setTimeout(()=>{v(!0)},150)),o}),S(o=>e===x&&(o===""||o.charAt(o.length-1)===" ")?o:o+t)},[p,h]),Z=l.exports.useCallback(()=>{const e=p.charAt(p.length-1);if(e==="")return;const t=g.current;let r;if(e===" ")if(h[t[0]-1].isCorrect)r=t;else if(h[t[0]-1].isSkip){const n=h[t[0]-1].letterArr.findIndex(s=>s.isCorrect===null);r=[t[0]-1,n]}else{const s=y(a.current)[t[0]-1].getElementsByClassName("letter");r=[t[0]-1,s.length]}else{const n=y(a.current)[t[0]],s=n.getElementsByClassName("extra-letter");s&&s.length>0&&n.removeChild(s[s.length-1]),r=[t[0],t[1]-1]}g.current=r,b(),W(n=>(e===" "?n[t[0]-1].isCorrect===!1&&(n[t[0]-1].isCorrect=null):n[t[0]].letterArr.length>=t[1]&&(n[t[0]].letterArr[t[1]-1].isCorrect=null,n[t[0]].isCorrect=null),n)),S(n=>{let s=!0;return e===" "&&h[t[0]-1].isCorrect&&(s=!1),s?n.substring(0,n.length-1):n})},[p,h]),_=e=>{console.log(e.key,e.keyCode,e.metaKey),e.key!=="Enter"&&(e.preventDefault(),e.stopPropagation(),e.persist()),!N&&(I(!1),e.key.length===1&&e.key!==" "?(i.current.time.begin===0&&(i.current.time.begin=Date.now()),P(e.keyCode,e.key)):e.keyCode===oe?Z():(e.keyCode===x||e.key==="Enter")&&P(x," "))},H=()=>{B(!0),m.current.focus()},R=l.exports.useCallback(()=>{g.current=[0,0],E.current=F.shuffle(E.current),i.current={wpm:"",right:0,wrong:0,acc:0,time:{begin:0,secs:0}};const e=a.current.getElementsByClassName("extra-letter");e.length!==0&&Array.from(e).forEach(t=>{t.parentNode.removeChild(t)}),W(F.jsonCopy(E.current.slice(0,w)).map(t=>Object.assign({},t,{letterArr:Array.from(t.text).map(r=>({letter:r,isCorrect:null,inputVal:"0"})),isCorrect:null,isSkip:!1}))),S(""),A(!1),v(!1),setTimeout(()=>{H(),b()},10)},[w]);return l.exports.useEffect(()=>{E.current=F.getWords(f.$state.root.wordsMode,f.$state.root.customerWords),R();const e=()=>{Y()};return m.current&&m.current.addEventListener("focus",e),()=>{m.current&&m.current.removeEventListener("focus",e)}},[f.$state.root.wordsMode,f.$state.root.customerWords,R,w]),d("div",{className:"Monkey",children:[d(j,{style:{position:"fixed",top:0,right:0,padding:"20px",zIndex:1},children:[c(k,{children:$?c(le,{value:q,format:"m:ss",valueStyle:{color:"yellow",fontWeight:"bold",padding:"10px",margin:"5px"},onFinish:()=>T(!1)}):c("div",{style:{fontSize:"24px",color:"yellow",fontWeight:"bold",padding:"10px",margin:"5px"},children:"5:00"})}),d(k,{children:[" ",c(te,{"vertical-align":"middle",type:"primary",shape:"round",onClick:X,style:{marginTop:"15px"},children:"\u5F00\u59CB\u5012\u8BA1\u65F6"})]})]}),c("div",{className:"word-count-radio",children:c(z.Group,{value:w,size:"small",onChange:e=>{V(e.target.value)},children:c(z.Button,{tabIndex:-1,value:100,children:"100"})})}),d(j,{justify:"center",align:"middle",children:[d(k,{flex:"900px",className:`type-main-box ${Q?"fading":""} ${N?"hide":""}`,children:[c("div",{className:`caret ${O?D?"flash":"":"hide"}`,ref:U,style:{transform:`translate3d(${M.left}px,${M.top}px,0)`}}),c("div",{className:"words-box",onClick:H,ref:a,children:h.map((e,t)=>{var r;return d("div",{className:`word ${e.isCorrect?"correct":e.isCorrect===!1?"wrong":""}`,children:[c("div",{className:"label",children:e.label}),(r=e.letterArr)==null?void 0:r.map((n,s)=>c("code",{className:`letter ${n.isCorrect?"correct":n.isCorrect===!1?"wrong":""}`,children:n.isCorrect===!1?n.inputVal:n.letter},`${t}_${s}`))]},t)})}),c("input",{className:"hidden-input",type:"text",ref:m,onKeyDown:_,onBlur:()=>{B(!1)},onFocus:()=>{B(!0),I(!0)}}),c("div",{className:"reload-line",children:c(G,{onClick:R})}),d("div",{className:`tip-line ${D?"":"hide"}`,children:[c("div",{children:"\u70B9\u51FB\u8BCD\u5757\u8FDB\u5165\u8F93\u5165\u72B6\u6001"}),c("div",{children:"\u8F93\u5165\u6B63\u786E\u7684\u5B57\u7B26\uFF0C\u7136\u540E\u7A7A\u683C"}),d("div",{children:["\u8F93\u5165\u72B6\u6001\u4E0B",c("code",{children:"Tab"}),"\u540E\u56DE\u8F66\u53EF\u4EE5\u76F4\u63A5\u5237\u65B0"]})]})]}),d(k,{flex:"900px",className:`type-result-box ${N?"show":""}`,children:[c(se,{desc:"WPM",numStr:i.current.wpm,acc:i.current.acc,secs:i.current.time.secs}),c("div",{className:"reload-line",children:c(G,{onClick:R})})]})]})]})};var fe=ne(ce);export{fe as default};
